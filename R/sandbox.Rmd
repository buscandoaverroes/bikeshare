---
title: "sandbox"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
load(file.path(processed, "data/sandbox.Rdata"))
```

# Graphs

## Destination Parity

##### departure gini histogram

most departures are between 0.5 and 0.75 Gini

```{r}
ggplot(sum_station_end, aes(dep_ineq)) +
  geom_histogram() 
```

#### destination gini vs top05p

The Percent of departures that end up in the top 5% of departures stations seem to be farily predictive of the GINI measurement.

```{r}
ggplot(sum_station_end, aes(dep_ineq, departures_pct_top05)) +
  geom_point()
```

#### gini vs sd

But sd doesn't seem to be as good of a measurement

```{r}
ggplot(sum_station_end, aes(dep_ineq, sd)) +
  geom_point()
```

#### gini vs pct metro

We see a somewhat noticeable difference in going-to-metro patterns in 2020

```{r}
ggplot(sum, aes(dep_ineq, metro_end_pct)) +
  geom_point() +
  facet_grid(rows = vars(year))
```

#### gini vs median duration

we also see a noticeable difference in median duration across all gini levels in 2020

```{r}
ggplot(sum, aes(dep_ineq, dur_med)) +
  geom_point() +
  facet_grid(rows = vars(year))
```

What does the regression look like?

1.  looks like departure parity does help predict median ride duration, with higher gini coefficients suggesting shorter median durations.

2.  however, the patterns of member usage at the station appear to be a much better predictor

3.  this pattern holds true across all years, but the year 2020 saw significantly lower median ride durations, holding all other factors constant.

```{r}
lm1 <- lm(dur_med ~ dep_ineq + member_pct + metro + as.factor(year), data = sum)
summary(lm1)
```

#### member pct vs duration

```{r}
ggplot(sum, aes(member_pct, dur_med, color = metro)) +
  geom_point(alpha = 0.3) +
  facet_grid(rows = vars(year))
```

#### gini vs duration sd

Also, we see a stark difference in the standard deviation of duration of rides from stations in 2020

```{r}
ggplot(sum, aes(dep_ineq, dur_sd)) +
  geom_point() +
  facet_grid(rows = vars(year))
```

Reducing the y limits:

```{r}
ggplot(sum, aes(dep_ineq, dur_sd)) +
  geom_point() +
  ylim(0, 600) +
  facet_grid(rows = vars(year)) 
```

coloring for percent member: we see that higher standard deviations in ride length are not just driven by non-members

```{r}
ggplot(sum, aes(dep_ineq, dur_sd, color = member_pct)) +
  geom_point(alpha = 0.6) +
  ylim(0, 600) +
  facet_grid(rows = vars(year)) 
```
